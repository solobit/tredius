// Generated by CoffeeScript 1.4.0
var __hasProp = {}.hasOwnProperty,
  __extends = function(child, parent) { for (var key in parent) { if (__hasProp.call(parent, key)) child[key] = parent[key]; } function ctor() { this.constructor = child; } ctor.prototype = parent.prototype; child.prototype = new ctor(); child.__super__ = parent.prototype; return child; },
  __indexOf = [].indexOf || function(item) { for (var i = 0, l = this.length; i < l; i++) { if (i in this && this[i] === item) return i; } return -1; };

module.exports = function(BasePlugin) {
  var ServicesPlugin;
  return ServicesPlugin = (function(_super) {

    __extends(ServicesPlugin, _super);

    function ServicesPlugin() {
      return ServicesPlugin.__super__.constructor.apply(this, arguments);
    }

    ServicesPlugin.prototype.name = 'services';

    ServicesPlugin.prototype.templateData = {
      getSocialButtons: function(socialButtons) {
        var result, socialButton, _i, _len;
        result = '';
        socialButtons || (socialButtons = ['GooglePlusOne', 'RedditSubmit', 'HackerNewsSubmit', 'FacebookLike', 'FacebookFollow', 'TwitterTweet', 'TwitterFollow', 'GithubFollow', 'QuoraFollow']);
        for (_i = 0, _len = socialButtons.length; _i < _len; _i++) {
          socialButton = socialButtons[_i];
          result += this['get' + socialButton + 'Button'].call(this);
        }
        return result;
      },
      getGooglePlusOneButton: function() {
        var pageUrl, _ref;
        pageUrl = (this.site.url || '') + this.document.url.replace(/\/index.html$/, '').replace(/\/$/, '');
        if (((_ref = this.site) != null ? _ref.services.googlePlusOneButton : void 0) === false) {
          return '';
        }
        return "<div class=\"google-plus-one-button social-button\">\n	<div class=\"g-plusone\" data-size=\"medium\" data-href=\"" + (escape(pageUrl)) + "\"></div>\n	<script>\n		(function() {\n			var po = document.createElement('script'); po.type = 'text/javascript'; po.async = true;\n			po.src = 'https://apis.google.com/js/plusone.js';\n			var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(po, s);\n		})();\n	</script>\n</div>";
      },
      getRedditSubmitButton: function() {
        var pageUrl, _ref;
        pageUrl = (this.site.url || '') + this.document.url.replace(/\/index.html$/, '').replace(/\/$/, '');
        if (((_ref = this.site) != null ? _ref.services.redditSubmitButton : void 0) === false) {
          return '';
        }
        return "<div class=\"reddit-submit-button social-button\">\n	<script type=\"text/javascript\" src=\"http://en.reddit.com/static/button/button1.js\"></script>\n</div>";
      },
      getHackerNewsSubmitButton: function() {
        var pageUrl, _ref;
        pageUrl = (this.site.url || '') + this.document.url.replace(/\/index.html$/, '').replace(/\/$/, '');
        if (((_ref = this.site) != null ? _ref.services.hackerNewsSubmitButton : void 0) === false) {
          return '';
        }
        return "<div class=\"hacker-news-submit-button social-button\">\n	<a href=\"http://news.ycombinator.com/submit\" class=\"hn-share-button\" data-url=\"" + pageUrl + "\">Vote on HN</a>\n	<script>\n		(function(d, t) {\n			var g = d.createElement(t),\n				s = d.getElementsByTagName(t)[0];\n				g.src = '//hnbutton.appspot.com/static/hn.min.js';\n			s.parentNode.insertBefore(g, s);\n		}(document, 'script'));\n	</script>\n</div>";
      },
      getFacebookLikeButton: function() {
        var facebookApplicationId, pageUrl, _ref, _ref1;
        facebookApplicationId = ((_ref = this.site) != null ? (_ref1 = _ref.services.facebookLikeButton) != null ? _ref1.applicationId : void 0 : void 0) || '266367676718271';
        pageUrl = (this.site.url || '') + this.document.url.replace(/\/index.html$/, '').replace(/\/$/, '');
        if (!facebookApplicationId) {
          return '';
        }
        return "<div class=\"facebook-like-button social-button\">\n	<iframe src=\"//www.facebook.com/plugins/like.php?href=" + (escape(pageUrl)) + "&amp;send=false&amp;layout=button_count&amp;width=450&amp;show_faces=false&amp;font&amp;colorscheme=light&amp;action=like&amp;height=21&amp;appId=" + (escape(facebookApplicationId)) + "\" scrolling=\"no\" frameborder=\"0\" style=\"border:none; overflow:hidden; width:450px; height:21px;\" allowTransparency=\"true\"></iframe>\n</div>";
      },
      getFacebookFollowButton: function() {
        var facebookApplicationId, facebookUsername, _ref, _ref1, _ref2, _ref3;
        facebookApplicationId = ((_ref = this.site) != null ? (_ref1 = _ref.services.facebookFollowButton) != null ? _ref1.applicationId : void 0 : void 0) || '266367676718271';
        facebookUsername = (_ref2 = this.site) != null ? (_ref3 = _ref2.services.facebookFollowButton) != null ? _ref3.username : void 0 : void 0;
        if (!(facebookUsername && facebookApplicationId)) {
          return '';
        }
        return "<div class=\"facebook-follow-button social-button\">\n	<iframe src=\"//www.facebook.com/plugins/follow.php?href=https%3A%2F%2Fwww.facebook.com%2F" + (escape(facebookUsername)) + "&amp;layout=button_count&amp;show_faces=false&amp;colorscheme=light&amp;font&amp;width=450&amp;appId=" + (escape(facebookApplicationId)) + "\" scrolling=\"no\" frameborder=\"0\" style=\"border:none; overflow:hidden; width:450px; height: 20px;\" allowTransparency=\"true\"></iframe>\n</div>";
      },
      getTwitterTweetButton: function() {
        var twitterUsername, _ref;
        twitterUsername = (_ref = this.site) != null ? _ref.services.twitterTweetButton : void 0;
        if (!twitterUsername) {
          return '';
        }
        return "<div class=\"twitter-tweet-button social-button\">\n	<a href=\"https://twitter.com/share\" class=\"twitter-share-button\" data-via=\"" + twitterUsername + "\" data-related=\"" + twitterUsername + "\">Tweet</a>\n	<script>!function(d,s,id){var js,fjs=d.getElementsByTagName(s)[0];if(!d.getElementById(id)){js=d.createElement(s);js.id=id;js.src=\"//platform.twitter.com/widgets.js\";fjs.parentNode.insertBefore(js,fjs);}}(document,\"script\",\"twitter-wjs\");</script>\n</div>";
      },
      getTwitterFollowButton: function() {
        var twitterUsername, _ref;
        twitterUsername = (_ref = this.site) != null ? _ref.services.twitterFollowButton : void 0;
        if (!twitterUsername) {
          return '';
        }
        return "<div class=\"twitter-follow-button social-button\">\n	<a href=\"https://twitter.com/" + twitterUsername + "\" class=\"twitter-follow-button\" data-show-count=\"false\">Follow @" + twitterUsername + "</a>\n	<script>!function(d,s,id){var js,fjs=d.getElementsByTagName(s)[0];if(!d.getElementById(id)){js=d.createElement(s);js.id=id;js.src=\"//platform.twitter.com/widgets.js\";fjs.parentNode.insertBefore(js,fjs);}}(document,\"script\",\"twitter-wjs\");</script>\n</div>";
      },
      getGithubFollowButton: function() {
        var githubUsername, _ref;
        githubUsername = (_ref = this.site) != null ? _ref.services.githubFollowButton : void 0;
        if (!githubUsername) {
          return '';
        }
        return "<div class=\"github-follow-button social-button\">\n	<iframe src=\"//ghbtns.com/github-btn.html?user=" + githubUsername + "&type=follow&count=true\" allowtransparency=\"true\" frameborder=\"0\" scrolling=\"0\" width=\"165\" height=\"20\"></iframe>\n</div>";
      },
      getQuoraFollowButton: function() {
        var quoraCode, quoraRealname, quoraUsername, _ref;
        quoraUsername = ((_ref = this.site) != null ? _ref.services.quoraFollowButton : void 0) || '';
        quoraRealname = quoraUsername.replace(/-/g, ' ');
        quoraCode = '7N31XJs';
        if (!quoraUsername) {
          return '';
        }
        return "<div class=\"quora-follow-button social-button\">\n	<span class=\"quora-follow-button\" data-name=\"" + quoraUsername + "\">\n		Follow <a href=\"http://www.quora.com/" + quoraUsername + "\">" + quoraRealname + "</a> on <a href=\"http://www.quora.com\">Quora</a>\n		<script type=\"text/javascript\" src=\"//www.quora.com/widgets/follow?embed_code=" + quoraCode + "\"></script>\n	</span>\n</div>";
      },
      getDisqus: function() {
        var disqusDeveloper, disqusIdentifier, disqusShortname, disqusTitle, pageUrl, _ref;
        disqusShortname = (_ref = this.site) != null ? _ref.services.disqus : void 0;
        disqusDeveloper = __indexOf.call(this.getEnvironments(), 'production') >= 0 ? '0' : '1';
        pageUrl = (this.site.url || '') + this.document.url.replace(/\/index.html$/, '').replace(/\/$/, '');
        disqusIdentifier = this.document.slug;
        disqusTitle = this.document.title || this.document.name;
        if (!disqusShortname) {
          return '';
        }
        return "<div id=\"disqus_thread\"></div>\n<script>\n	(function(){\n		window.disqus_shortname = '" + disqusShortname + "';\n		window.disqus_developer = '" + disqusDeveloper + "';\n		window.disqus_url = '" + pageUrl + "';\n		window.disqus_identifier = '" + disqusIdentifier + "';\n		window.disqus_title = '" + disqusTitle + "';\n		if ( window.DISQUS ) {\n			return DISQUS.reset({\n				reload: true,\n				config: function () {\n					this.page.identifier = window.disqus_identifier;\n					this.page.url = window.disqus_url;\n					this.page.title = window.disqus_title;\n				}\n			});\n		}\n		else {\n		  var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;\n		  dsq.src = 'http://' + disqus_shortname + '.disqus.com/embed.js';\n		  (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);\n		}\n	})();\n</script>\n<noscript>Please enable JavaScript to view the <a href=\"http://disqus.com/?ref_noscript\">comments powered by Disqus.</a></noscript>\n<a href=\"http://disqus.com\" class=\"dsq-brlink\">comments powered by <span class=\"logo-disqus\">Disqus</span></a>";
      },
      getGauges: function() {
        var gaugesSiteId, _ref, _ref1;
        gaugesSiteId = (_ref = this.site) != null ? (_ref1 = _ref.services) != null ? _ref1.gauges : void 0 : void 0;
        if (!gaugesSiteId) {
          return '';
        }
        return "var _gauges = _gauges || [];\n(function(){\n	var t = document.createElement('script');\n	t.type = 'text/javascript';\n	t.async = true;\n	t.id = 'gauges-tracker';\n	t.setAttribute('data-site-id', '" + gaugesSiteId + "');\n	t.src = '//secure.gaug.es/track.js';\n	var s = document.getElementsByTagName('script')[0];\n	s.parentNode.insertBefore(t, s);\n})();";
      },
      getGoogleAnalytics: function() {
        var googleAccountId, _ref, _ref1;
        googleAccountId = (_ref = this.site) != null ? (_ref1 = _ref.services) != null ? _ref1.googleAnalytics : void 0 : void 0;
        if (!googleAccountId) {
          return '';
        }
        return "var _gaq = _gaq || [];\n_gaq.push(['_setAccount', '" + googleAccountId + "']);\n_gaq.push(['_trackPageview']);\n(function(){\n	var ga = document.createElement('script'); ga.type = 'text/javascript'; ga.async = true;\n	ga.src = ('https:' == document.location.protocol ? 'https://ssl' : 'http://www') + '.google-analytics.com/ga.js';\n	var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(ga, s);\n})();";
      },
      getMixpanel: function() {
        var mixpanelId, _ref, _ref1;
        mixpanelId = (_ref = this.site) != null ? (_ref1 = _ref.services) != null ? _ref1.mixpanel : void 0 : void 0;
        if (!mixpanelId) {
          return '';
        }
        return "(function(c,a){window.mixpanel=a;var b,d,h,e;b=c.createElement(\"script\");b.type=\"text/javascript\";b.async=!0;b.src=(\"https:\"===c.location.protocol?\"https:\":\"http:\")+'//cdn.mxpnl.com/libs/mixpanel-2.2.min.js';d=c.getElementsByTagName(\"script\")[0];d.parentNode.insertBefore(b,d);a._i=[];a.init=function(b,c,f){function d(a,b){var c=b.split(\".\");2==c.length&&(a=a[c[0]],b=c[1]);a[b]=function(){a.push([b].concat(Array.prototype.slice.call(arguments,0)))}}var g=a;\"undefined\"!==typeof f?g=a[f]=[]:f=\"mixpanel\";g.people=g.people||[];h=['disable','track','track_pageview','track_links','track_forms','register','register_once','unregister','identify','alias','name_tag','set_config','people.set','people.increment'];for(e=0;e<h.length;e++)d(g,h[e]);a._i.push([b,c,f])};a.__SV=1.2;})(document,window.mixpanel||[]);mixpanel.init(\"" + mixpanelId + "\");";
      },
      getReinvigorate: function() {
        var reinvigorateId, _ref, _ref1;
        reinvigorateId = (_ref = this.site) != null ? (_ref1 = _ref.services) != null ? _ref1.reinvigorate : void 0 : void 0;
        if (!reinvigorateId) {
          return '';
        }
        return "(function(){\n	var t = document.createElement('script');\n	t.type = 'text/javascript';\n	t.async = true;\n	t.src = '//include.reinvigorate.net/re_.js';\n	t.onload = function(){\n		reinvigorate.track(\"" + reinvigorateId + "\");\n	};\n	var s = document.getElementsByTagName('script')[0];\n	s.parentNode.insertBefore(t,s);\n})();";
      },
      getZopim: function() {
        var zopimId, _ref, _ref1;
        zopimId = (_ref = this.site) != null ? (_ref1 = _ref.services) != null ? _ref1.zopim : void 0 : void 0;
        if (!zopimId) {
          return '';
        }
        return "window.$zopim||(function(d,s){var z=$zopim=function(c){z._.push(c)},$=z.s=d.createElement(s),e=d.getElementsByTagName(s)[0];z.set=function(o){z.set._.push(o)};z._=[];z.set._=[];$.async=!0;$.setAttribute('charset','utf-8');$.src='//cdn.zopim.com/?" + zopimId + "';z.t=+new Date;$.type='text/javascript';e.parentNode.insertBefore($,e)})(document,'script');";
      }
    };

    ServicesPlugin.prototype.extendTemplateData = function(opts) {
      var templateData, templateHelper, templateHelperName, _ref;
      templateData = opts.templateData;
      _ref = this.templateData;
      for (templateHelperName in _ref) {
        if (!__hasProp.call(_ref, templateHelperName)) continue;
        templateHelper = _ref[templateHelperName];
        templateData[templateHelperName] = templateHelper;
      }
      return this;
    };

    ServicesPlugin.prototype.populateCollections = function(opts) {
      var config, docpad, scripts, scriptsBlock, serviceScript, serviceScriptContent, serviceScripts, templateData, _i, _len;
      docpad = this.docpad;
      config = this.config;
      templateData = docpad.getTemplateData();
      scriptsBlock = docpad.getBlock('scripts');
      scripts = [];
      serviceScripts = ['Gauges', 'GoogleAnalytics', 'Mixpanel', 'Reinvigorate', 'Zopim'];
      for (_i = 0, _len = serviceScripts.length; _i < _len; _i++) {
        serviceScript = serviceScripts[_i];
        serviceScriptContent = templateData['get' + serviceScript].call(templateData);
        if (serviceScriptContent) {
          scripts.push(serviceScriptContent);
        }
      }
      scriptsBlock.add(scripts, {
        defer: false
      });
      return this;
    };

    return ServicesPlugin;

  })(BasePlugin);
};
